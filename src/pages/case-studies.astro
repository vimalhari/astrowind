---
import Layout from '~/layouts/PageLayout.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import CaseStudyCard from '~/components/CaseStudyCard.astro';
import { getCollection } from 'astro:content';
import { sortCaseStudies, getUniqueValues } from '~/utils/case-study-utils';

const metadata = {
  title: 'Case Studies - Success Stories | Criztec Technologies',
  description:
    'Discover how Criztec Technologies transforms businesses with cutting-edge web development, digital marketing, and technology solutions. Real client success stories and results.',
  robots: {
    index: true,
    follow: true,
  },
  openGraph: {
    type: 'website',
    title: 'Client Success Stories - Case Studies | Criztec Technologies',
    description:
      'See how we help businesses grow with modern web solutions, from WordPress to Astro migrations, digital marketing campaigns, and performance optimizations.',
    image: '~/assets/images/hero-image.webp',
  },
  canonical: 'https://criztec.com/case-studies',
};

// Get all case studies from Content Collections
const allCaseStudies = await getCollection('case-studies', ({ id, data }) => {
  return !data.draft && !id.startsWith('_');
});

// Sort by publish date (newest first)
const sortedCaseStudies = sortCaseStudies(allCaseStudies, 'date', false);

// Get filter options for service categories
const categories = getUniqueValues(allCaseStudies, 'category');
---

<Layout metadata={metadata}>
  <!-- Enhanced Hero Section -->
  <section class="relative bg-gradient-to-br from-gray-900 via-blue-900 to-indigo-900 overflow-hidden">
    <!-- Background Elements -->
    <div
      class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMyI+PGNpcmNsZSBjeD0iMyIgY3k9IjMiIHI9IjMiLz48L2c+PC9nPjwvc3ZnPg==')] opacity-20"
    >
    </div>
    <div class="absolute top-0 right-0 w-96 h-96 bg-blue-500/20 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 left-0 w-64 h-64 bg-purple-500/20 rounded-full blur-3xl"></div>

    <div class="relative px-4 py-20 mx-auto max-w-7xl lg:px-8 lg:py-28">
      <div class="text-center mb-16">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6">Client Success Stories</h1>
        <p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-4xl mx-auto mb-8">
          Discover how we transform businesses with innovative technology solutions, delivering measurable results that
          drive growth and success.
        </p>

        <!-- Stats Bar -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto">
          <div class="text-center">
            <div class="text-3xl md:text-4xl font-bold text-blue-400 mb-2">{allCaseStudies.length}+</div>
            <div class="text-sm text-gray-300">Success Stories</div>
          </div>
          <div class="text-center">
            <div class="text-3xl md:text-4xl font-bold text-green-400 mb-2">{categories.length}</div>
            <div class="text-sm text-gray-300">Service Categories</div>
          </div>
          <div class="text-center">
            <div class="text-3xl md:text-4xl font-bold text-purple-400 mb-2">98%</div>
            <div class="text-sm text-gray-300">Client Satisfaction</div>
          </div>
          <div class="text-center">
            <div class="text-3xl md:text-4xl font-bold text-yellow-400 mb-2">250%</div>
            <div class="text-sm text-gray-300">Avg. Improvement</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Case Studies Grid -->
  <section class="px-4 py-16 mx-auto max-w-7xl lg:px-8">
    <!-- Case Studies Grid -->
    <div id="case-studies-grid" class="masonry-grid">
      {sortedCaseStudies.map((study, index) => <CaseStudyCard study={study} index={index} />)}
    </div>
  </section>

  <!-- CTA Section -->
  <CallToAction
    title="Ready to Start Your Success Story?"
    subtitle="Let's discuss how we can help transform your business with innovative technology solutions"
    actions={[
      {
        variant: 'primary',
        text: 'Start Your Project',
        href: '/contact',
        icon: 'tabler:message-circle',
      },
      {
        text: 'View Our Services',
        href: '/services',
      },
    ]}
  />
</Layout>

<style>
  /* Modern Masonry Layout */
  .masonry-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    grid-auto-rows: max-content;
    gap: 2rem;
    align-items: start;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .masonry-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }

  @media (min-width: 769px) and (max-width: 1024px) {
    .masonry-grid {
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.75rem;
    }
  }

  @media (min-width: 1025px) {
    .masonry-grid {
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 2rem;
    }
  }

  /* Card enhancements for masonry layout */
  .case-study-card {
    break-inside: avoid;
    page-break-inside: avoid;
  }

  /* Improved hover effects for variable height cards */
  .case-study-card:hover {
    transform: translateY(-8px) scale(1.02);
  }

  /* Ensure consistent spacing in flex layout */
  .case-study-card .flex-1 {
    min-height: 200px;
  }
</style>
